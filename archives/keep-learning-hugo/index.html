<!doctype html><html lang=zh-cn><meta charset=utf-8><meta name=renderer content="webkit"><meta name=force-rendering content="webkit"><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=preconnect href=https://cdn.staticfile.org><meta http-equiv=x-dns-prefetch-control content="on"><link rel=dns-prefetch href=//cdn.staticfile.org><link rel=preload href=/font/notoserifsc-regular-webfont.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/font/merriweather-regular-webfont.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/font/notoserifsc-regular-webfont.woff as=font type=font/woff crossorigin><link rel=preload href=/font/merriweather-regular-webfont.woff as=font type=font/woff crossorigin><title>继续折腾Hugo</title><meta name=description content="一个简单的博客，一个平凡的博主，用最扑实的话记录最真实的自己！"><meta name=author content="老麦"><link rel=stylesheet href=https://iamlm.com/scss/laomai.min.b5a20acb207c8cf4fbde439dab506619de780bf7ce6f2046ccb4b3d27d24e2d1.css integrity="sha256-taIKyyB8jPT73kOdq1BmGd54C/fObyBGzLSz0n0k4tE=" rel="preload stylesheet" as=style><link rel=stylesheet href=https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css><body style=background:url(https://cdn.qylao.com/wp-content/uploads/2022/04/sea-gc05b59c74_1920.jpg);background-size:cover;background-attachment:fixed><div class=container><div class=main-container><div class=tabs-main><input type=checkbox id=menu-btn>
<label for=menu-btn class=menu-icon><i class="fa fa-bars" aria-hidden=true></i></label><div class=main-header><div class=logo><img src=https://cdn.qylao.com/wp-content/uploads/2021/04/apple-touch-icon.png alt=老麦></div><div class=logo-con><p>一个简单的博客，一个平凡的博主，用最扑实的话记录最真实的自己！</div><div class=line1></div></div><div class=menu><ul class=tabs><li class=menu-item><a href=/>首页</a><li class=menu-item><a href=/archives/>文章</a><li class=menu-item><a href=/bb/>闲言</a><li class=menu-item><a href=/about/>关于</a><li class=menu-item><a href=/links/>友链</a></ul></div><div class=post-toc><nav id=TableOfContents><ol><li><a href=#jsdelivr的cdn服务原来是有限制的>Jsdelivr的CDN服务原来是有限制的</a><li><a href=#为匹配主题的暗色模式更换评论系统>为匹配主题的暗色模式更换评论系统</a><ol><li><a href=#服务器环境>服务器环境</a><li><a href=#部署waline服务端>部署Waline服务端</a><li><a href=#数据转换>数据转换</a></ol><li><a href=#小结>小结</a></ol></nav></div><div class=main-footer><p>&copy;2022老麦</p><span>已记录<span>109904</span>个字</span></div></div><div class=main-content><div class=content-header><h1>继续折腾Hugo</h1></div><div class=line2><div class=post-time><time datetime=2021-08-11T00:00:00>2021-08-11</time></div></div><div class="content ahover"><p>这段时间花了点时间把Hugo的主题给换了，Jane这个主题已经使用了一年，前前后后修改了很多次，改得已经不成样子了，我对这个主题是十分喜欢的。简约，该有的功能都有，基于Hugo的强大和易用性，集成一些其他功能变得十分简单、方便。虽然与Wordpress对比起来略差一丝，但对于个人博客来说，Hugo绝对称得上优秀。<p>这次换主题主要是看中了 <strong>Stack</strong> 这个主题对文章的构建比 Jane优雅，新建一篇文章的话，只要在<code>/content/post/</code>里新开一个文件夹，然后将Markdown文件和图片都扔到这里就可以了，这样的好处就是整理归档起来十分的清晰。当然Jane这个主题稍作修改也能实现这个功能，毕竟这其实就是Hugo自带的Page Bundles<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>功能。<p>选择直接更换而不去修改的原因之一是因为之前的主题被我修改得有点乱，再大刀阔斧下去感觉意义不大了。其次就是我最近状态不怎么好，还是直接使用新主题来得实际一点。以后时间充裕的话可以考虑以Jane为底子去重新写一个新的主题，我个人还是十分喜欢这种简约风格的。<p>下面记录一下这次更换主题碰到两个问题：<h2 id=jsdelivr的cdn服务原来是有限制的>Jsdelivr的CDN服务原来是有限制的</h2><p>在之前的周记里写过如何在Hugo上媷JsdelivrCDN的羊毛<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>，天真的我以为这种好日子可以一直下去，事实证明这又是我自己一个人的一厢情愿罢了。因为 <strong>Stack</strong> 主题默认情况下给文章添加一张特色图片才会达到最佳的效果，无奈只好去Pixabay扒图，方便倒是挺方便的，可没想到的是随着图片越来越多，Jsdelivr就来了一记重拳。提示「Package size exceeded the configured limit of 50 MB.」。老实说，我开始真不知道原来Jsdelivr有这个限制的，虽然网上也有一些取巧的方法去解决，但个人觉得这不是长久之计，只能以后再另辟途径吧。<h2 id=为匹配主题的暗色模式更换评论系统>为匹配主题的暗色模式更换评论系统</h2><p>半年前我将评论系统换成了Twikoo，这大半年使用下来还算满意，数据存在腾讯云开发 CloudBase 上也放心，但不知是不是因为节点是广州的原因，数据读取偶尔会抽风一会，速度一般吧，属于可以接受的范围。<p>新主题有个暗色模式，当切换模式时Twikoo评论的样式就显得有点不搭，尝试修改样式进行匹配，效果只能说一般。主题的作者自己开发的评论系统没有开源，但我发现作者在主题上对Waline这个评论做了简单的适配，而且Waline本身自带暗色模式，这样的话匹配度就更高了。既然如此，那就换评论系统吧，反正自己一直想尝试一下这个评论系统，主要也因为个人感觉Waline自由度更高一点，可以部署在 Vercel 、CloudBase<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>或者自己的服务器上。<p>这次使用Waline我一开始尝试了Vercel+LeanCloud的组合，老实说，足够使用，速度和稳定性方面都很好，主要还免费。我最后选择部署在自己服务器上的原因其实是想多尝试尝试。前段时间学习了一些Docker的基础，正好Waline也支持这种方式来部署，所以决定尝试使用Docker+MySQL这样的组合。<h3 id=服务器环境>服务器环境</h3><p>Docker的安装可以使用官方安装脚本自动安装：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>curl -fsSL https://get.docker.com | bash -s docker --mirror aliyun
</span></span></code></pre></div><p>启动Docker：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>systemctl start docker
</span></span></code></pre></div><p>设置Docker自动启动：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>systemctl <span style=color:#8be9fd;font-style:italic>enable</span> docker
</span></span></code></pre></div><p>至于其他安装方法可以参考：<a href=https://www.runoob.com/docker/docker-tutorial.html target=_blank rel=noopener>Docker 教程 | 菜鸟教程 (runoob.com)</a><p>我服务器上安装了宝塔并且一键搭建了LNMP环境，如果你和我一样可以直接跳过下面这一步。<p><strong>Docker安装MySQL：</strong><p>以安装MySQL5.7为例，拉取镜像：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker pull mysql:5.7
</span></span></code></pre></div><p>创建并运行容器：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker run -d -p 3306:3306 --name mysql <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f1fa8c></span>--restart<span style=color:#ff79c6>=</span>always <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f1fa8c></span>-e <span style=color:#8be9fd;font-style:italic>MYSQL_ROOT_PASSWORD</span><span style=color:#ff79c6>=</span>密码 <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f1fa8c></span>-e <span style=color:#8be9fd;font-style:italic>TZ</span><span style=color:#ff79c6>=</span>Asia/Shanghai <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#f1fa8c></span>-v /laomai/mysql/conf:/etc/mysql/conf.d <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#f1fa8c></span>-v /laomai/mysql/logs:/var/log/mysql <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#f1fa8c></span>-v /laomai/mysql/data:/var/lib/mysql <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#f1fa8c></span>mysql:5.7 --character-set-server<span style=color:#ff79c6>=</span>utf8mb4 --collation-server<span style=color:#ff79c6>=</span>utf8mb4_unicode_ci
</span></span></code></pre></div><p>命令说明：<p><code>-d</code>后台运行；<p><code>-p 3306:3306</code>设置容器的对外端口；<p><code>--name mysql</code>设置容器的名字；<p><code>--restart=always</code>设置自启；<p><code>-e MYSQL_ROOT_PASSWORD=密码</code>设置MySQL的root密码；<p><code>-e TZ=Asia/Shanghai</code>设置时区；<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>-v /laomai/mysql/conf:/etc/mysql/conf.d <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f1fa8c></span>-v /laomai/mysql/logs:/var/log/mysql <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#f1fa8c></span>-v /laomai/mysql/data:/var/lib/mysql \
</span></span></code></pre></div><p>挂载相应的目录，格式为<code>-v 主机目录:容器内目录</code>；<p><code>mysql:5.7 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</code>设置字符集与校对集；<p>最后创建一个数据库和用户，这里可以直接进入容器内部创建或者本地使用Navicat工具连接数据库后创建，这里推荐使用Navicat，操作起来直观很多。<p><strong>温馨提示：记得到服务器的安全组开放3306端口。</strong><p>在Navicat上使用用root用户连接到数据库，按F6进入命令列界面，分别输入以下命令进行创建：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>//</span> 创建新的数据库并设置其编码
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>mysql<span style=color:#ff79c6>&gt;</span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>DATABASE</span> 数据库名字 <span style=color:#ff79c6>DEFAULT</span> <span style=color:#ff79c6>CHARSET</span><span style=color:#ff79c6>=</span>utf8 <span style=color:#ff79c6>DEFAULT</span> <span style=color:#ff79c6>COLLATE</span> utf8_unicode_ci;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>//</span> 创建新用户并设置密码
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>mysql<span style=color:#ff79c6>&gt;</span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>USER</span> <span style=color:#f1fa8c>&#39;用户名&#39;</span><span style=color:#ff79c6>@</span><span style=color:#f1fa8c>&#39;服务器IP&#39;</span> <span style=color:#ff79c6>IDENTIFIED</span> <span style=color:#ff79c6>BY</span> <span style=color:#f1fa8c>&#39;密码&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>//</span> 将新建的数据库管理权限赋予新建的用户
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>mysql<span style=color:#ff79c6>&gt;</span><span style=color:#ff79c6>GRANT</span> <span style=color:#ff79c6>ALL</span> <span style=color:#ff79c6>PRIVILEGES</span> <span style=color:#ff79c6>ON</span> <span style=color:#f1fa8c>&#39;数据库名字&#39;</span> <span style=color:#ff79c6>TO</span> <span style=color:#f1fa8c>&#39;用户名&#39;</span><span style=color:#ff79c6>@</span><span style=color:#f1fa8c>&#39;%&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>//</span> 刷新权限
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>mysql<span style=color:#ff79c6>&gt;</span><span style=color:#ff79c6>FLUSH</span> <span style=color:#ff79c6>PRIVILEGES</span>;
</span></span></code></pre></div><p><strong>温馨提示：导入 <a href=https://github.com/walinejs/waline/blob/main/assets/waline.sqlite target=_blank rel=noopener>waline.sql</a> 到刚刚新建的数据库里完成表和表结构的创建，右键点击数据库，选择运行SQL文件即可。</strong><h3 id=部署waline服务端>部署Waline服务端</h3><p><strong>拉取Waline镜像：</strong><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>docker pull lizheming/waline
</span></span></code></pre></div><p>接下就运行容器，但在运行之前我们先了解一下Waline服务端相应的环境变量<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>，相对应的MySQL变量和简单的评论邮件通知变量如下：<table><thead><tr><th style=text-align:left>环境变量名称<th style=text-align:center>必填<th style=text-align:center>默认值<th style=text-align:left>备注<tbody><tr><td style=text-align:left><code>MYSQL_HOST</code><td style=text-align:center><td style=text-align:center>127.0.0.1<td style=text-align:left>MySQL 服务的地址<tr><td style=text-align:left><code>MYSQL_PORT</code><td style=text-align:center><td style=text-align:center>3306<td style=text-align:left>MySQL 服务的端口<tr><td style=text-align:left><code>MYSQL_DB</code><td style=text-align:center>✅<td style=text-align:center><td style=text-align:left>MySQL 数据库库名<tr><td style=text-align:left><code>MYSQL_USER</code><td style=text-align:center>✅<td style=text-align:center><td style=text-align:left>MySQL 数据库的用户名<tr><td style=text-align:left><code>MYSQL_PASSWORD</code><td style=text-align:center>✅<td style=text-align:center><td style=text-align:left>MySQL 数据库的密码<tr><td style=text-align:left><code>MYSQL_PREFIX</code><td style=text-align:center><td style=text-align:center><code>wl_</code><td style=text-align:left>MySQL 数据表的表前缀<tr><td style=text-align:left><code>MYSQL_CHARSET</code><td style=text-align:center><td style=text-align:center><code>utf8mb4</code><td style=text-align:left>MySQL 数据表的字符集</table><table><thead><tr><th>环境变量名称<th>备注<tbody><tr><td><code>SMTP_SERVICE</code><td>SMTP 邮件发送服务提供商<tr><td><code>SMTP_HOST</code><td>SMTP 服务器地址，一般可以在邮箱的设置中找到。<tr><td><code>SMTP_PORT</code><td>SMTP 服务器端口，一般可以在邮箱的设置中找到。<tr><td><code>SMTP_USER</code><td>SMTP 邮件发送服务的用户名，一般为登录邮箱。<tr><td><code>SMTP_PASS</code><td>SMTP 邮件发送服务的密码，一般为邮箱登录密码，部分邮箱(例如 163)是单独的 SMTP 密码。<tr><td><code>SENDER_NAME</code><td>自定义发送邮件的发件人<tr><td><code>SENDER_EMAIL</code><td>自定义发送邮件的发件地址</table><p><strong>温馨提示：</strong><p><code>SMTP_SERVICE</code>可以在<a href=https://github.com/nodemailer/nodemailer/blob/master/lib/well-known/services.json target=_blank rel=noopener>这里</a>查看支持的服务商。<code>SMTP_SERVICE</code> 和 (<code>SMTP_HOST</code>、<code>SMTP_PORT</code>）任选其一即可，如果没有在列表中知道对应的 <code>SMTP_SERVICE</code> 的话则需要配 <code>SMTP_HOST</code> 和 <code>SMTP_PORT</code>。<p>参照上面的环境变量后输入以下命令<strong>运行并创建容器：</strong><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>docker run -d -p 8360:8360 --name waline <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#f1fa8c></span>  -v /laomai/waline/data:/app/data <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>TZ</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Asia/Shanghai&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>MYSQL_HOST</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;IP&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>MYSQL_PORT</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;3306&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>MYSQL_DB</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;数据库名字&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>MYSQL_USER</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;用户名&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>MYSQL_PASSWORD</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;密码&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>AUTHOR_EMAIL</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;博主邮箱&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>SITE_NAME</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;网站名字&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>SITE_URL</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;网站地址&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>SMTP_SERVICE</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Gmail&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>SMTP_USER</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;xxx@gmail.com&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#f1fa8c></span>  -e <span style=color:#8be9fd;font-style:italic>SMTP_PASS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;Gmail应用密码&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#f1fa8c></span>  --restart always <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#f1fa8c></span>  lizheming/waline
</span></span></code></pre></div><p>注：<code>-e MYSQL_HOST="IP"</code>不知为何我直接使用本地IP<code>127.0.0.1</code>的话，评论时会提示连接不了数据库进行提交。直接使用服务器的内网IP和公网IP都能正常使用。<code>-e SMTP_PASS="Gmail应用密码"</code>这里不是填Gmail的登陆密码，应用密码须到Google账号——安全性——开启两步验证后才能独立申请。<p>打开<code>http://IP:8360</code>就能进入Waline的服务端了，打开<code>http://IP:8360/ui/register</code>进行注册，首个注册用户会设定成管理员。<p><strong>绑定域名进行反向代理：</strong><p>方法一、直接使用Nginx进行配置<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>server</span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>  <span style=color:#ff79c6>listen</span> <span style=color:#bd93f9>80</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>  <span style=color:#ff79c6>listen</span> <span style=color:#bd93f9>443</span> <span style=color:#f1fa8c>ssl</span> <span style=color:#f1fa8c>http2</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>  <span style=color:#ff79c6>server_name</span> <span style=color:#f1fa8c>your.domain.server.name</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>  <span style=color:#ff79c6>root</span> <span style=color:#f1fa8c>/www/wwwroot/your.domain.server.name</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>  <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>(</span><span style=color:#8be9fd;font-style:italic>$server_port</span> <span style=color:#f1fa8c>!~</span> <span style=color:#bd93f9>443</span><span style=color:#f1fa8c>)</span>{
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>rewrite</span> <span style=color:#f1fa8c>^(/.*)</span>$ <span style=color:#f1fa8c>https://</span><span style=color:#8be9fd;font-style:italic>$host$1</span> <span style=color:#f1fa8c>permanent</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>  <span style=color:#6272a4># SSL setting
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>ssl_certificate</span> <span style=color:#f1fa8c>fullchain.pem</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>  <span style=color:#ff79c6>ssl_certificate_key</span> <span style=color:#f1fa8c>privkey.pem</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>  <span style=color:#ff79c6>ssl_protocols</span> <span style=color:#f1fa8c>TLSv1.1</span> <span style=color:#f1fa8c>TLSv1.2</span> <span style=color:#f1fa8c>TLSv1.3</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>  <span style=color:#ff79c6>ssl_ciphers</span> <span style=color:#f1fa8c>EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>  <span style=color:#ff79c6>ssl_prefer_server_ciphers</span> on;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>  <span style=color:#ff79c6>ssl_session_cache</span> <span style=color:#f1fa8c>shared:SSL:10m</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>  <span style=color:#ff79c6>ssl_session_timeout</span> <span style=color:#bd93f9>10m</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>  <span style=color:#ff79c6>add_header</span> <span style=color:#f1fa8c>Strict-Transport-Security</span> <span style=color:#f1fa8c>&#34;max-age=31536000&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>  <span style=color:#6272a4># proxy to 8360
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>location</span> <span style=color:#f1fa8c>/</span> {
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#ff79c6>proxy_pass</span> <span style=color:#f1fa8c>http://127.0.0.1:8360</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#ff79c6>proxy_set_header</span> <span style=color:#f1fa8c>Host</span> <span style=color:#8be9fd;font-style:italic>$host</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    <span style=color:#ff79c6>proxy_set_header</span> <span style=color:#f1fa8c>X-Real-IP</span> <span style=color:#8be9fd;font-style:italic>$remote_addr</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    <span style=color:#ff79c6>proxy_set_header</span> <span style=color:#f1fa8c>X-Forwarded-For</span> <span style=color:#8be9fd;font-style:italic>$proxy_add_x_forwarded_for</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#ff79c6>proxy_set_header</span> <span style=color:#f1fa8c>X-Forwarded-Proto</span> <span style=color:#8be9fd;font-style:italic>$scheme</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    <span style=color:#ff79c6>proxy_set_header</span> <span style=color:#f1fa8c>REMOTE-HOST</span> <span style=color:#8be9fd;font-style:italic>$remote_addr</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#ff79c6>add_header</span> <span style=color:#f1fa8c>X-Cache</span> <span style=color:#8be9fd;font-style:italic>$upstream_cache_status</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#6272a4># cache
</span></span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>add_header</span> <span style=color:#f1fa8c>Cache-Control</span> <span style=color:#f1fa8c>no-cache</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    <span style=color:#ff79c6>expires</span> <span style=color:#f1fa8c>12h</span>;
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>}
</span></span></code></pre></div><p>方法二、在宝塔上进行设置：<p>宝塔面板——网站——添加站点——填写域名即可（其他的都不需要，我们只是用它来做反向代理和配置HTTPS）<p>宝塔面板——网站——设置——反向代理——添加反向代理——填写代理名称（Waline）和目标URL（<code>http://127.0.0.1:8360</code>）<p>配置SSL的方法有很多，如果不想折腾，直接在宝塔面板上申请免费的 Let’s Encrypt 证书即可。<h3 id=数据转换>数据转换</h3><p>Waline官网提供了一个迁移助手<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>，我Hugo上的评论之前都是存在 CloudBase 上的，数据导出来后利用迁移助手将JSON文件转换成CSV格式，然后就可以导进MySQL上了，因为Twikoo上使用了时间戳，直接导入MySQL会变成<code>0000-00-00 00:00</code>。<p><strong>解决办法：</strong><p>利用Navicat进行重新定义时间格式再导入。<p><p><img src=2021-08-10-202147.webp alt=2021-08-10-202147><p><img src=2021-08-10-202341.webp alt=2021-08-10-202341><p><img src=2021-08-10-202925.webp alt=2021-08-10-202925><h2 id=小结>小结</h2><p>静态博客什么都好，就是这个评论有点难搞，特别是数据转换这块，在各个第三方评论系统中转换问题不大，从Wordpress、Typecho导出来也容易，但想导回去就难了。办法虽然有，就是笨了一点，估计要一篇篇文章去改了。<p>至于为什么我转到Wordpress了还去折腾Hugo？老实说，我也不知道为什么。可能是我心底深处认为Hugo更适合我一点吧~<section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>详情请参考：<a href=https://gohugo.io/content-management/page-bundles/ target=_blank rel=noopener>Page Bundles | Hugo (gohugo.io)</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a><li id=fn:2 role=doc-endnote><p>详情请参考：<a href=https://iamlm.com/2021/week-27-of-2021/#hugo%e5%ae%9e%e7%8e%b0%e5%9b%be%e7%89%87%e6%87%92%e5%8a%a0%e8%bd%bd%e5%b9%b6%e8%96%85%e7%be%8a%e6%af%9b target=_blank rel=noopener>2021年第27周 (iamlm.com)</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a><li id=fn:3 role=doc-endnote><p>适用于已有免费基础版 1 环境，或计划付费购买腾讯云云开发包年包月环境的的用户。&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a><li id=fn:4 role=doc-endnote><p>详情请参考：<a href=https://waline.js.org/reference/server.html target=_blank rel=noopener>服务端配置 | Waline</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a><li id=fn:5 role=doc-endnote><p>Waline官网提供的<a href=https://waline.js.org/guide/server/vps-deploy.html#nginx-%e9%85%8d%e7%bd%ae target=_blank rel=noopener>参考模板</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a><li id=fn:6 role=doc-endnote><p>详情请移步到：<a href=https://waline.js.org/migration/tool.html target=_blank rel=noopener>https://waline.js.org/migration/tool.html</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></ol></section></div><div class="content-tags ahover"><ul><li><a href=/tags/hugo>#hugo</a><li><a href=/tags/waline>#waline</a><li><a href=/tags/twikoo>#twikoo</a><li><a href=/tags/stack>#stack</a><li><a href=/tags/jane>#jane</a><li><a href=/tags/jsdelivr>#jsdelivr</a><li><a href=/tags/cdn>#cdn</a><li><a href=/tags/docker>#docker</a><li><a href=/tags/navicat>#navicat</a><li><a href=/tags/mysql>#mysql</a><li><a href=/tags/wordpress>#Wordpress</a></ul></div><nav class=post-nav><a class=prev href=/archives/modification-record-of-waline-comments/><i class="fa fa-chevron-left" aria-hidden=true></i>
<span class="prev-text nav-default">Waline评论之修改记录</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/archives/week-31-32/><span class="next-text nav-default">台风、转校、疫苗、笔记</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class="fa fa-chevron-right" aria-hidden=true></i></a></nav><div class=content-footer><script src=//cdn.qylao.com/dist/Waline.min.js></script><div id=waline class=waline-container></div><style>:root{--waline-font-size:1rem;--waline-theme-color:rgba(0,0,0,0.7);--waline-active-color:#202020;--waline-badge-color:rgba(0,0,0,0.3)}.v[data-class=v] .vcard .vhead .vnick svg{display:none}.v[data-class=v] .vpower{display:none}.wl-emoji{width:1rem}</style><script>new Waline({avatarCDN:"https://sdn.geekzu.org/avatar/",dark:'html[data-scheme="dark"]',el:"#waline",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],lang:"zh-cn",locale:{admin:"⭐"},placeholder:"在这里分享您的观点与想法，昵称、邮箱必填，邮件通知回复。",requiredMeta:["nick","mail"],serverURL:"https://comments.iamlm.com/",visitor:!0})</script></div></div></div></div><script src=https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js></script>
<script defer src=https://iamlm.com/js/laomai.min.b185718dcc7e0011e0f6e3ca17f13e9492d8ea286c14f7bad0c8a9ba0b6c64741e77b66fab6e45ea4d37c39fe5a787447eb5f0160e70b7be5996d2925768bf9a.js integrity="sha512-sYVxjcx+ABHg9uPKF/E+lJLY6ihsFPe60MipugtsZHQed7Zvq25F6k03w5/lp4dEfrXwFg5wt75ZltKSV2i/mg==" crossorigin=anonymous async></script>